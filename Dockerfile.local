FROM alpine:3.7 AS builder

RUN apk add --update --no-cache ca-certificates


FROM alpine:3.7

RUN apk add --update libcap && rm -rf /var/cache/apk/*

COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

ARG BUILD_DIR
ARG BINARY_NAME

COPY $BUILD_DIR/$BINARY_NAME /usr/local/bin/anchore-image-validator

RUN adduser -D anchore-image-validator
RUN setcap CAP_NET_BIND_SERVICE=+eip /usr/local/bin/anchore-image-validator
USER anchore-image-validator

ENTRYPOINT ["/usr/local/bin/anchore-image-validator"]
